<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>个人信息管理</title>
    <link href="../stylesheets/infoManage.css" rel="stylesheet">
</head>
<body>
    <div class="person-card clearfix">
        <div class="person-img">
            <img class="img-fit" src="../images/header.jpeg">
            <div class="float-title">
                修改头像
                <input type="file" class="img-cover">
            </div>
        </div>
        <div class="person-info">
            <input id="kf_id" type="text" name="" value="编号" readonly="readonly">
            <input id="kf_nick" type="text" placeholder="昵称">
            <input id="pre_pw" type="password" placeholder="新密码">
            <input id="res_pw" type="password" placeholder="重输密码">
            <div class="option">
                <span id="status"></span>
                <a type="submit" href="javascript:void(0)" class="submit"><span>→</span></a>
            </div>
        </div>
    </div>
<script src="../plugins/jquery-2.1.3.min.js"></script>
<script type="text/javascript">
    $("#kf_id").val($("#user-id", parent.document).text());
    $("#kf_nick").attr("placeholder", $("#user-name", parent.document).text());

    $(".float-title input").on("change", function(){
        if (this.files.length != 0) {
            var file = this.files[0],
                reader = new FileReader();
            if (!reader) {
                this.value = '';
                return;
            };
            reader.onload = function(e) {
                $(".person-img img").attr("src", e.target.result);
            };
            reader.readAsDataURL(file);
        };
    });

    $(".submit").on("click", function(){
        $("#status").text("");
        if(!$("#pre_pw").val()){
            $("#status").text("密码不能为空~").css("color", "red");
        }
        if($("#pre_pw").val() != $("#res_pw").val()){
            $("#status").text("两次密码输入不同~").css("color", "red");
            return;
        }
        $.post("/update",{
            kf_id: $("#kf_id").val(),
            kf_nick: $("#kf_nick").val(),
            password: $("#res_pw").val(),
            img: $(".person-img img").attr("src")
        }, function(data){
            if(data.state == "success"){
                $("#status").text("信息重置成功~").css("color", "green");
            }else {
                $("#status").text("信息重置失败~").css("color", "red");
            }
        });
    });
</script>
</body>
</html>
